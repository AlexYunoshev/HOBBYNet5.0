@{
    ViewBag.Title = "Изменение локации";
}

<input style="margin: 10px;" type="submit" id="locationButton" onclick="initMap()"/>
<div style="margin: 10px; height: 60%; width:60%; position:absolute" id="map"></div>
<form id="form1" asp-action="Location" method="post">
    <input id="latitude" type="hidden" name="latitude" value="" />
    <input id="longitude" type="hidden" name="longitude" value="" />
</form>

<script >

    let map, infoWindow;

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 49.0734487, lng: 33.2565712 },
            zoom: 5.74,
        });
        infoWindow = new google.maps.InfoWindow();


        const locationButton = document.getElementById("locationButton");


        locationButton.addEventListener("click", () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        infoWindow.setPosition(pos);
                        infoWindow.setContent("Location found");
                        infoWindow.open(map);

                        var positionMarker = new google.maps.Marker({
                            position: pos,
                            map,
                            title: "Your current location",
                        });

                        map.setCenter(pos);
                        map.setZoom(15);
                        document.getElementById("latitude").value = pos.lat;
                        document.getElementById("longitude").value = pos.lng;
                        document.getElementById("form1").submit();
                    },
                    () => {
                        handleLocationError(true, infoWindow, map.getCenter());
                    }
                );
            } else {
                handleLocationError(false, infoWindow, map.getCenter());
            }
        });
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
            browserHasGeolocation
                ? "Error: The Geolocation service failed."
                : "Error: Your browser doesn't support geolocation."
        );
        infoWindow.open(map);
    }

</script>

<script src="https://maps.googleapis.com/maps/api/js?callback=initMap" async></script>